<!-- <div class="fixed inset-0 flex items-center justify-center z-50">
  <app-spinner [loader]="loader" />
</div> -->

@if (successMessage) {
<div
  class="fixed top-4 right-4 z-50 px-4 py-2 bg-green-100 text-green-800 rounded-md shadow-lg transform transition-transform duration-500 ease-in-out"
  [class.translate-x-0]="successMessage"
  [class.translate-x-40]="!successMessage"
>
  {{ successMessage }}
</div>
}

<div class="p-4 md:p-6 bg-gray-50 relative">
  <!-- Page Header -->
  <div
    class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6"
  >
    <h2 class="text-xl font-semibold text-blue-800">Leave Management</h2>
    <button
      class="py-2! px-4! mb-10! bg-blue-600 text-white rounded-lg! hover:bg-blue-700 transition-colors flex items-center justify-center w-full sm:w-auto"
      (click)="openModal()"
    >
      Add Leave
    </button>
  </div>

  <div class="flex mb-3! border-b-2 border-gray-300">
    <button
      (click)="changeTab('allLeaves')"
      [class.bg-blue-600]="currentTab === 'allLeaves'"
      [class.text-white]="currentTab === 'allLeaves'"
      [class.border-blue-600]="currentTab === 'allLeaves'"
      [class.text-gray-500]="currentTab !== 'allLeaves'"
      [class.border-transparent]="currentTab !== 'allLeaves'"
      class="py-2 px-4 font-medium border-b-2 rounded-tl-lg! rounded-tr-lg! hover:text-blue-600 transition-colors"
    >
      All Leaves
    </button>
    <button
      (click)="changeTab('leaveRequests')"
      [class.bg-blue-600]="currentTab === 'leaveRequests'"
      [class.text-white]="currentTab === 'leaveRequests'"
      [class.border-blue-600]="currentTab === 'leaveRequests'"
      [class.text-gray-500]="currentTab !== 'leaveRequests'"
      [class.border-transparent]="currentTab !== 'leaveRequests'"
      class="py-2 px-4 font-medium border-b-2 rounded-tl-lg! rounded-tr-lg! hover:text-blue-600 transition-colors"
    >
      Leave Requests
    </button>
  </div>

  <div id="leaveTabContent">
    @if (currentTab=='allLeaves') {
    <div class="overflow-x-auto">
      <div
        class="bg-white rounded-lg shadow-md border-t-4 border-blue-600 min-w-[600px]"
      >
        <div>
          <h6 class="font-semibold text-blue-800">All Leave Requests</h6>
        </div>
        <table class="w-full border-collapse">
          <thead>
            <tr class="bg-gray-50">
              <th class="text-left p-3 font-semibold text-blue-800 border-b">
                Leave ID
              </th>
              <th class="text-left p-3 font-semibold text-blue-800 border-b">
                Employee
              </th>
              <th class="text-left p-3 font-semibold text-blue-800 border-b">
                Leave Type
              </th>
              <th class="text-left p-3 font-semibold text-blue-800 border-b">
                From Date
              </th>
              <th class="text-left p-3 font-semibold text-blue-800 border-b">
                To Date
              </th>
              <th class="text-left p-3 font-semibold text-blue-800 border-b">
                Days
              </th>
              <th class="text-left p-3 font-semibold text-blue-800 border-b">
                Status
              </th>
              <!-- <th class="text-left p-3 font-semibold text-blue-800 border-b">
              Actions
            </th> -->
            </tr>
          </thead>
          <tbody>
            @for (item of paginatedLeaves; track $index) {
            <tr class="hover:bg-gray-50">
              <td class="p-3 border-b">
                {{ $index + 1 + (startPage - 1) * pageBreak }}
              </td>
              <td class="p-3 border-b">{{ item.employeeName }}</td>
              <td class="p-3 border-b">{{ item.leaveType }}</td>
              <td class="p-3 border-b">
                {{ item.fromDate | date : "dd-MM-yy" }}
              </td>
              <td class="p-3 border-b">
                {{ item.toDate | date : "dd-MM-yyyy" }}
              </td>
              <td class="p-3 border-b">{{ item.noOfDays }}</td>
              <td class="p-3 border-b">
                @if(item.isApproved==null){
                <span
                  class="px-2! py-1! bg-yellow-100 text-yellow-800 rounded-full text-xs"
                  >Pending</span
                >}@else if(item.isApproved==true) {
                <span
                  class="px-2! py-1! bg-yellow-100 text-yellow-800 rounded-full text-xs"
                  >Approved</span
                >}@else if (item.isApproved==false) {<span
                  class="px-2! py-1! bg-yellow-100 text-yellow-800 rounded-full text-xs"
                  >Rejected</span
                >}
              </td>
              <!-- <td class="p-3 border-b flex gap-2">
              <button
                class="px-2! py-1! bg-green-100 text-green-800 rounded-md! hover:bg-green-200 transition-colors"
                (click)="approveLeave(item.leaveId)"
              >
                Approve
              </button>
              <button
                class="px-2! py-1! bg-red-100 text-red-800 rounded-md! hover:text-white hover:bg-red-800 transition-colors"
                (click)="rejectLeave(item.leaveId)"
              >
                Reject
              </button>
            </td> -->
            </tr>
            }
          </tbody>
        </table>
        <div class="flex gap-2 justify-center mt-4 items-center">
          <!-- Jump to First -->
          <button
            (click)="changePage(1)"
            class="w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200"
            [disabled]="startPage === 1"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-4 h-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11 19l-7-7 7-7m8 14V5"
              />
            </svg>
          </button>

          <!-- Previous -->
          <button
            (click)="changePage(startPage - 1)"
            class="w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200"
            [disabled]="startPage === 1"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-4 h-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 19l-7-7 7-7"
              />
            </svg>
          </button>

          <!-- Page Numbers -->
          @for (page of visiblePages; track page) {
          <button
            (click)="changePage(page)"
            [class.bg-blue-600]="startPage === page"
            [class.text-white]="startPage === page"
            class="px-3 py-1 border rounded-md! hover:bg-blue-500 hover:text-white"
          >
            {{ page }}
          </button>
          }

          <!-- Next -->
          <button
            (click)="changePage(startPage + 1)"
            class="w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200"
            [disabled]="startPage === totalPages"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-4 h-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              />
            </svg>
          </button>

          <!-- Jump to Last -->
          <button
            (click)="changePage(totalPages)"
            class="w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200"
            [disabled]="startPage === totalPages"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-4 h-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 5l7 7-7 7M5 5v14"
              />
            </svg>
          </button>
        </div>
      </div>
    </div>
    }@else{
    <div
      id="leaveRequests"
      class="p-4 bg-white rounded-lg shadow-md border-t-4 border-blue-600"
    >
      <div>
        <h6 class="font-semibold text-yellow-500!">Pending Leave Requests</h6>
      </div>
      <table class="w-full border-collapse">
        <thead>
          <tr class="bg-gray-50">
            <th class="text-left p-3 font-semibold text-blue-800 border-b">
              Leave ID
            </th>
            <th class="text-left p-3 font-semibold text-blue-800 border-b">
              Employee
            </th>
            <th class="text-left p-3 font-semibold text-blue-800 border-b">
              Leave Type
            </th>
            <th class="text-left p-3 font-semibold text-blue-800 border-b">
              From Date
            </th>
            <th class="text-left p-3 font-semibold text-blue-800 border-b">
              To Date
            </th>
            <th class="text-left p-3 font-semibold text-blue-800 border-b">
              Days
            </th>
            <th class="text-left p-3 font-semibold text-blue-800 border-b">
              Status
            </th>
            <th class="text-left p-3 font-semibold text-blue-800 border-b">
              Actions
            </th>
          </tr>
        </thead>
        <tbody>
          @for (item of paginatedApprovals; track $index) {
          <tr class="hover:bg-gray-50">
            <td class="p-3 border-b">
              {{ $index + 1 + (approvalStartPage - 1) * approvalPageBreak }}
            </td>
            <td class="p-3 border-b">{{ item.employeeName }}</td>
            <td class="p-3 border-b">{{ item.leaveType }}</td>
            <td class="p-3 border-b">
              {{ item.fromDate | date : "dd-MM-yy" }}
            </td>
            <td class="p-3 border-b">
              {{ item.toDate | date : "dd-MM-yyyy" }}
            </td>
            <td class="p-3 border-b">{{ item.noOfDays }}</td>
            <td class="p-3 border-b">
              @if(item.isApproved==null){
              <span
                class="px-2! py-1! bg-yellow-100 text-yellow-800 rounded-full text-xs"
                >Pending</span
              >}@else if(item.isApproved==true) {
              <span
                class="px-2! py-1! bg-yellow-100 text-yellow-800 rounded-full text-xs"
                >Approved</span
              >}@else if (item.isApproved==false) {<span
                class="px-2! py-1! bg-yellow-100 text-yellow-800 rounded-full text-xs"
                >Rejected</span
              >}
            </td>
            <td class="p-3 border-b flex gap-2">
              <button
                class="px-2! py-1! bg-blue-100 text-blue-800 rounded-md! hover:bg-blue-200 transition-colors view-leave-btn"
                (click)="approveLeave(item.leaveId)"
              >
                Approve
              </button>
              <button
                class="px-2! py-1! bg-red-100 text-red-800 rounded-md! hover:text-white hover:bg-red-800 transition-colors"
                (click)="rejectLeave(item.leaveId)"
              >
                Reject
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
      <div class="flex gap-2 justify-center mt-4 items-center">
        <!-- Jump to First -->
        <button
          (click)="changeApprovalPage(1)"
          class="w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200"
          [disabled]="approvalStartPage === 1"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-4 h-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M11 19l-7-7 7-7m8 14V5"
            />
          </svg>
        </button>

        <!-- Previous -->
        <button
          (click)="changeApprovalPage(approvalStartPage - 1)"
          class="w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200"
          [disabled]="approvalStartPage === 1"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-4 h-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </button>

        <!-- Page Numbers -->
        @for (page of visibleApprovalPages; track page) {
        <button
          (click)="changeApprovalPage(page)"
          [class.bg-blue-600]="approvalStartPage === page"
          [class.text-white]="approvalStartPage === page"
          class="px-3 py-1 border rounded-md! hover:bg-blue-500 hover:text-white"
        >
          {{ page }}
        </button>
        }

        <!-- Next -->
        <button
          (click)="changeApprovalPage(approvalStartPage + 1)"
          class="w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200"
          [disabled]="approvalStartPage === approvalTotalPages"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-4 h-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"
            />
          </svg>
        </button>

        <!-- Jump to Last -->
        <button
          (click)="changeApprovalPage(approvalTotalPages)"
          class="w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200"
          [disabled]="approvalStartPage === approvalTotalPages"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-4 h-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 5l7 7-7 7M5 5v14"
            />
          </svg>
        </button>
      </div>
    </div>
    }
  </div>

  <div
    class="absolute inset-0 rounded-md! hidden z-50 items-center justify-center transition-opacity duration-600 ease-in-out p-4!"
    id="addLeaveModal"
    #newModal
  >
    <div
      class="bg-white rounded-lg! w-full max-w-3xl max-h-[90vh] overflow-y-auto shadow-xl transition-all duration-600 ease-in-out"
    >
      <div
        class="flex justify-between items-center p-3! bg-blue-600 text-white rounded-t-lg!"
      >
        <h3 class="text-lg font-semibold">Add New Leave</h3>
        <button
          class="text-4xl hover:text-red-800 close-modal"
          (click)="closeModal()"
        >
          &times;
        </button>
      </div>
      <div class="px-6! py-4!">
        <form [formGroup]="leaveForm">
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div class="mb-2">
              <label class="block text-sm font-medium text-blue-800 mb-1"
                >Leave Type</label
              >
              <select
                formControlName="leaveType"
                class="w-full px-3 py-2 border border-blue-600 rounded-md focus:outline-none focus:border-cyan-400"
              >
                <option>Annual Leave</option>
                <option>Sick Leave</option>
                <option>Emergency Leave</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="block text-sm font-medium text-blue-800 mb-1"
                >From Date</label
              >
              <input
                formControlName="fromDate"
                type="date"
                class="w-full px-3 py-2 border border-blue-600 rounded-md focus:outline-none focus:border-cyan-400 focus:ring-2 focus:ring-cyan-100 transition-all"
              />
            </div>
            <div class="mb-2">
              <label class="block text-sm font-medium text-blue-800 mb-1"
                >To Date</label
              >
              <input
                formControlName="toDate"
                type="date"
                class="w-full px-3 py-2 border border-blue-600 rounded-md focus:outline-none focus:border-cyan-400 focus:ring-2 focus:ring-cyan-100 transition-all"
              />
            </div>
            <div class="mb-2">
              <label class="block text-sm font-medium text-blue-800 mb-1"
                >Number of Days</label
              >
              <input
                formControlName="noOfDays"
                type="number"
                class="w-full px-3 py-2 border border-blue-600 rounded-md focus:outline-none focus:border-cyan-400 focus:ring-2 focus:ring-cyan-100 transition-all"
              />
            </div>
            <div class="mb-2 col-span-2">
              <label class="block text-sm font-medium text-blue-800 mb-1"
                >Reason</label
              >
              <textarea
                formControlName="details"
                class="w-full px-3 py-2 border border-blue-600 rounded-md focus:outline-none focus:border-cyan-400 focus:ring-2 focus:ring-cyan-100 transition-all"
              ></textarea>
            </div>
          </div>
          <div class="flex justify-end gap-4 pt-4 border-t border-blue-100">
            <button
              type="button"
              (click)="closeModal()"
              class="px-4 py-1 bg-red-300 text-red-800 rounded-md! hover:bg-red-800 hover:text-white transition-colors close-modal"
            >
              Cancel
            </button>
            <button
              type="button"
              (click)="onSave()"
              class="px-4 py-1 bg-blue-600 text-white rounded-md! hover:bg-blue-700 transition-colors"
            >
              Submit Leave
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- View Leave Modal -->
  <div
    class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50"
    id="viewLeaveModal"
  >
    <div
      class="bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-xl"
    >
      <div
        class="flex justify-between items-center p-6 bg-blue-600 text-white rounded-t-lg"
      >
        <h3 class="text-lg font-semibold">Leave Details</h3>
        <button class="text-4xl hover:text-red-800 close-modal">&times;</button>
      </div>
      <div class="px-6 py-4">
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <p class="text-sm text-blue-800 font-medium">Leave ID:</p>
            <p class="text-lg">LV-2023-001</p>
          </div>
          <div>
            <p class="text-sm text-blue-800 font-medium">Employee:</p>
            <p class="text-lg">John Doe (EMP-001)</p>
          </div>
          <div>
            <p class="text-sm text-blue-800 font-medium">Leave Type:</p>
            <p class="text-lg">Annual Leave</p>
          </div>
          <div>
            <p class="text-sm text-blue-800 font-medium">Status:</p>
            <p class="text-lg">
              <span
                class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm"
                >Pending</span
              >
            </p>
          </div>
          <div>
            <p class="text-sm text-blue-800 font-medium">From Date:</p>
            <p class="text-lg">15 Jan 2024</p>
          </div>
          <div>
            <p class="text-sm text-blue-800 font-medium">To Date:</p>
            <p class="text-lg">20 Jan 2024</p>
          </div>
          <div>
            <p class="text-sm text-blue-800 font-medium">Days:</p>
            <p class="text-lg">5</p>
          </div>
          <div class="col-span-2">
            <p class="text-sm text-blue-800 font-medium">Reason:</p>
            <p class="text-gray-700">
              Family vacation planned months in advance
            </p>
          </div>
        </div>
        <div class="flex justify-end gap-4 pt-4 border-t border-blue-100">
          <button
            type="button"
            class="px-4 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors close-modal"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
